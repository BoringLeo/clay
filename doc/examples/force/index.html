<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="shortcut icon" href="../../images/clay.png" type="image/x-png">
    <title>clay - 实例</title>
    <link rel="stylesheet" href="../../easycss-1.2.1.min.css">
    <link rel="stylesheet" href="../../style.css">
    <script src="../../../build/clay-1.2.1.min.js"></script>
    <script src="../../../test/exam/script.js"></script>
    <style>
        svg {
            padding: 10px;
            user-select: none;
        }

        circle {
            cursor: move;
        }

        text {
            font-size: 12px;
        }
    </style>
    <script>

        $$(function () {

            // 获取力布局
            var force = clay.layout.force(880, 480);

            // 设置处理方法
            force.bind('init', function (node) {

                $$('<circle id="' + node.id + '">').appendTo('.circle')
                    .attr('r', '10')
                    .attr('cx', node.x - (-10))
                    .attr('cy', node.y - (-5))
                    .attr('fill', node.color);

                $$('<text id="text-' + node.id + '" >' + node.info + '</text>').appendTo('.text')
                    .attr('x', node.x)
                    .attr('y', node.y)
                    .attr('fill', node.color)
            }, function (link, sourceNode, targetNode) {
                $$('<line source=' + sourceNode.id + ' target=' + targetNode.id + ' x1=' + sourceNode.x + ' y1=' + sourceNode.y + ' x2=' + targetNode.x + ' y2=' + targetNode.y + '>').appendTo('.line')
                    .attr('stroke-width', '2')
                    .attr('stroke', 'black');
            })
                .bind('update', function (node) {
                    $$('#' + node.id)
                        .attr('cx', node.x)
                        .attr('cy', node.y);
                    $$('#text-' + node.id)
                        .attr('x', node.x - (-10))
                        .attr('y', node.y - (-5));
                }, function (link, sourceNode, targetNode) {
                    $$('[source=' + link.link[0] + '][target=' + link.link[1] + ']')
                        .attr('x1', sourceNode.x)
                        .attr('y1', sourceNode.y)
                        .attr('x2', targetNode.x)
                        .attr('y2', targetNode.y);
                })
                ;

            // 绑定初始化数据
            force(
                [
                    { "id": 0, "info": "生物", "color": "red" },
                    { "id": 1, "info": "原核生物", "color": "blue" },
                    { "id": 2, "info": "真核生物", "color": "green" },
                    { "id": 3, "info": "动物界", "color": "#eea10d" },
                    { "id": 4, "info": "真菌界", "color": "#eea10d" },
                    { "id": 5, "info": "植物界", "color": "#eea10d" },
                    { "id": 6, "info": "原生生物界", "color": "#eea10d" },
                    { "id": 7, "info": "草本植物", "color": "pink" },
                    { "id": 8, "info": "木本植物", "color": "pink" },
                    { "id": 9, "info": "水生植物", "color": "pink" },
                    { "id": 10, "info": "有脊椎动物", "color": "#b211ee" },
                    { "id": 11, "info": "无脊椎动物", "color": "#b211ee" },
                    { "id": 12, "info": "腔肠动物", "color": "#eb0682" },
                    { "id": 13, "info": "扁形动物", "color": "#eb0682" },
                    { "id": 14, "info": "线形动物", "color": "#eb0682" },
                    { "id": 15, "info": "环节动物", "color": "#eb0682" },
                    { "id": 16, "info": "两栖动物", "color": "gray" },
                    { "id": 17, "info": "爬行动物", "color": "gray" },
                    { "id": 18, "info": "哺乳动物", "color": "gray" },
                    { "id": 19, "info": "鱼类", "color": "gray" },
                    { "id": 20, "info": "鸟类", "color": "gray" },
                    { "id": 21, "info": "软体动物", "color": "#eb0682" },
                    { "id": 22, "info": "节肢动物", "color": "#eb0682" },
                    { "id": 23, "info": "昆虫纲", "color": "#0c0107" },
                    { "id": 24, "info": "甲壳纲", "color": "#0c0107" },
                    { "id": 25, "info": "蛛形纲", "color": "#0c0107" },
                    { "id": 26, "info": "多足纲", "color": "#0c0107" },
                    { "id": 27, "info": "肢口纲", "color": "#0c0107" },
                    { "id": 28, "info": "鼠妇", "color": "#0c0107" }
                ], [
                    { "link": [0, 1], "length": 5 },
                    { "link": [0, 2], "length": 5 },
                    { "link": [2, 3], "length": 5 },
                    { "link": [2, 4], "length": 5 },
                    { "link": [2, 5], "length": 5 },
                    { "link": [2, 6], "length": 5 },
                    { "link": [5, 7], "length": 5 },
                    { "link": [5, 8], "length": 5 },
                    { "link": [5, 9], "length": 5 },
                    { "link": [3, 11], "length": 5 },
                    { "link": [3, 10], "length": 5 },
                    { "link": [11, 12], "length": 5 },
                    { "link": [11, 13], "length": 5 },
                    { "link": [11, 14], "length": 5 },
                    { "link": [11, 15], "length": 5 },
                    { "link": [11, 21], "length": 5 },
                    { "link": [11, 22], "length": 5 },
                    { "link": [10, 16], "length": 5 },
                    { "link": [10, 17], "length": 5 },
                    { "link": [10, 18], "length": 5 },
                    { "link": [10, 19], "length": 5 },
                    { "link": [10, 20], "length": 5 },
                    { "link": [22, 23], "length": 5 },
                    { "link": [22, 24], "length": 5 },
                    { "link": [22, 25], "length": 5 },
                    { "link": [22, 26], "length": 5 },
                    { "link": [22, 27], "length": 5 },
                    { "link": [22, 28], "length": 5 },
                ]
            );

            // 绑定事件
            var target, p, svgP;
            $$('circle')
                .bind('mousedown', function () {
                    target = clay(this);
                });
            $$('body')
                .bind('mouseup', function () {
                    target = null;
                })
                .bind('mousemove', function (event) {
                    event = event || window.event;
                    if (target) {
                        p = getMousePos(event);
                        svgP = calcViewportLocation($$('svg')[0]);
                        force
                            .update(target.attr('id'), 'x', p.x - 10 - svgP[0])
                            .update(target.attr('id'), 'y', p.y - 10 - svgP[1]);
                    }
                });

        });

    </script>
</head>

<body>
    <header id='top'>
        clay v1.2.1
        <ul>
            <li>
                <a href="../../index.html">首页</a>
            </li>
            <li>
                <a href="../index.html" class='click'>实例</a>
            </li>
            <li>
                <a href="../../apis/index.html">文档</a>
            </li>
            <li>
                <a href="../../aboutUs.html">加入我们</a>
            </li>
        </ul>
        <a href="https://github.com/yelloxing/clay" class="github">
            Fork me on GitHub
        </a>
    </header>
    <section>
        <svg width=900 height=500>
            <g class="line"></g>
            <g class="circle"></g>
            <g class="text"></g>
        </svg>
    </section>
    <footer>
        心叶 &copy;2007-2018 走一步，再走一步
        <a href="#top">回到顶部</a>
    </footer>
</body>

</html>
