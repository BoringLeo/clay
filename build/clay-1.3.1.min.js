/*!
*
* clay - Provide more flexible data visualization solutions!
* git+https://github.com/yelloxing/clay.git
* 
* author 心叶
*
* version 1.3.1
* 
* build Sun Jul 29 2018
*
* Copyright yelloxing
* Released under the MIT license
* 
* Date:Thu Nov 01 2018 00:23:03 GMT+0800 (CST)
*/

!function(t,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e(t):e(t)}("undefined"!=typeof window?window:this,function(t,c){"use strict";var w=function(t,e){return new w.prototype.init(t,e)};w.prototype.init=function(t,e){this.context=e=e||document;var r,n=a(t,e);for(r=0;r<n.length;r++)this[r]=n[r];return this.selector=t,this.length=n.length,this},w.prototype.init.prototype=w.prototype;var i={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},v={whitespace:"[\\x20\\t\\r\\n\\f]",identifier:"(?:\\\\.|[\\w-]|[^\0-\\xa0])+"},o=["href","title","show","type","role","actuate"];function a(t,e){var r,n=[];if("string"!=typeof t){if(!t||1!==t.nodeType&&11!==t.nodeType&&9!==t.nodeType){if(!t||t.constructor!==Array&&t.constructor!==HTMLCollection&&t.constructor!==NodeList)return t&&t.constructor===w?t:[];for(r=0;r<t.length;r++)!t[r]||1!==t[r].nodeType&&11!==t[r].nodeType&&9!==t[r].nodeType||n.push(t[r]);return n}return[t]}if("*"===(t=(t+"").trim().replace(/[\n\f\r]/g,"")))return e.getElementsByTagName("*");var o=v.whitespace,i=v.identifier,a="\\["+o+"{0,}"+i+"(?:"+o+"{0,}="+o+"{0,}(\\'|\\\"){0,1}"+i+"\\1{0,1}){0,1}"+o+"{0,}\\]";if(new RegExp("^(?:"+i+"){0,1}(?:(?:#|\\.)"+i+"|"+a+"){0,}$").test(t)){var h,s=t.match(new RegExp("#"+i,"g")),u=t.match(new RegExp("\\."+i,"g")),c=t.match(new RegExp("^"+i)),f=t.match(new RegExp(a,"g"));if(s){if(1<s.length)return[];h=(h=document.getElementById((s.shift(0)+"").replace(/^#/,"")))?[h]:[]}else h=e.getElementsByClassName&&u?e.getElementsByClassName((u.shift(0)+"").replace(/^\./,"")):c?e.getElementsByTagName(c.shift(0)):e.getElementsByTagName("*");var l,g,p,d,m=new RegExp("^\\["+o+"{0,}("+i+")(?:"+o+"{0,}="+o+"{0,}(?:\\'|\\\"){0,1}("+i+")(?:\\'|\\\"){0,1}){0,1}"+o+"{0,}\\]$");for(r=0;r<h.length;r++)if(d=!0,!(c&&0<c.length&&(c[0]+"").toUpperCase()!==(h[r].tagName+"").toUpperCase())){for(l=" "+h[r].getAttribute("class")+" ",g=0;d&&u&&g<u.length;g++)if(l.search(" "+(u[g]+"").replace(/\./,"")+" ")<0){d=!1;break}for(g=0;d&&f&&g<f.length;g++)if(l=m.exec(f[g]),null===(p=h[r].getAttribute(l[1]))||l[2]&&p!=l[2]){d=!1;break}d&&n.push(h[r])}return n}try{return[y(t)]}catch(t){return[]}}function y(t){var e=document.createElementNS(i.svg,"svg");new RegExp("^"+v.identifier+"$").test(t)&&(t="<"+t+"></"+t+">"),e.innerHTML=t;var r,n,o=e.childNodes;for(r=0;r<o.length;r++)if(1===o[r].nodeType||9===o[r].nodeType||11===o[r].nodeType){n=o[r];break}if("canvas"==n.tagName||/[A-Z]/.test(n.tagName))for((e=document.createElement("div")).innerHTML=t,o=e.childNodes,r=0;r<o.length;r++)if(1===o[r].nodeType||9===o[r].nodeType||11===o[r].nodeType){n=o[r];break}return n}w.prototype.find=function(t){if(this.length<=0)return w();var e,r=w(),n=a(t,this[0]);for(r.selector=t,e=0;e<n.length;e++)r[e]=n[e],r.length+=1;return r},w.prototype.eq=function(t){return this.length<=t?new w:new w(this[t])},w.prototype.appendTo=function(t){var e,r,n=w(t);for(e=0;e<n.length;e++)for(r=0;r<this.length;r++)n[e].appendChild(this[r]);return this},w.prototype.remove=function(){var t;for(t=0;t<this.length;t++)this[t].parentNode.removeChild(this[t]);return this},w.prototype.refresh=function(){var t,e=a(this.selector,this.context),r=this.length;for(t=this.length=0;t<e.length;t++)this[t]=e[t],this.length+=1;for(;t<r;t++)delete this[t];return this},w.prototype.attr=function(t,e){if(null==e||e==c)return 0<this.length?this[0].getAttribute(t):c;var r,n;for(r=0;r<this.length;r++)n="function"==typeof e?e(this[r]._data,r,this.eq(r)):e,/[A-Z]/.test(this[r].tagName)&&0<=o.indexOf(t)?this[r].setAttributeNS(i.xlink,"xlink:"+t,n):this[r].setAttribute(t,n);return this},w.prototype.css=function(t,e){if(arguments.length<=1&&"object"!=typeof t){if(this.length<1)return c;var r=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(this[0],null):this[0].currentStyle;return"string"==typeof t?r.getPropertyValue(t):r}var n,o;if(0<this.length)if("object"==typeof t)for(o in t)for(n=0;n<this.length;n++)this[n].style[o]="function"==typeof e?e(this[n]._data,n,o,t[o]):t[o];else for(n=0;n<this.length;n++)this[n].style[t]="function"==typeof e?e(this[n]._data,n):e;return this},w.prototype.datum=function(t,e){if(null===t||t===c)return 0<this.length?this[0]._data:c;var r;for(t="function"==typeof e?e(t):t,r=0;r<this.length;r++)this[r]._data=t;return this},w.prototype.data=function(t,e){var r,n=[];if(t&&t.constructor===Array){var o=w();for(o.selector=this.selector,r=0;r<t.length&&r<this.length;r++)this[r]._data="function"==typeof e?e(t[r]):t[r],o[r]=this[r],o.length+=1;for(o._enter=[];r<t.length;r++)o._enter.push("function"==typeof e?e(t[r]):t[r]);for(o._exit=[];r<this.length;r++)o._exit.push(this[r]);return o}for(r=0;r<this.length;r++)n[r]=this[r]._data;return n},w.prototype.enter=function(t){var e,r,n=w();for(n.selector=this.selector,e=0;this._enter&&e<this._enter.length;e++)(r=y(t))._data=this._enter[e],n[e]=r,n.length+=1;return delete this._enter,n},w.prototype.exit=function(){var t,e=w();for(e.selector=this.selector,t=0;this._exit&&t<this._exit.length;t++)e[t]=this._exit[t],e.length+=1;return delete this._exit,e},w.prototype.bind=function(t,e){var r;if(window.attachEvent)for(r=0;r<this.length;r++)this[r].attachEvent("on"+t,e);else for(r=0;r<this.length;r++)this[r].addEventListener(t,e,!1);return this},w.prototype.unbind=function(t,e){var r;if(window.detachEvent)for(r=0;r<this.length;r++)this[r].detachEvent("on"+t,e);else for(r=0;r<this.length;r++)this[r].removeEventListener(t,e,!1);return this},w.prototype.position=function(t){var e=this[0].getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}};var s={timers:[],interval:13,speeds:400,timerId:null};w.animation=function(e,t,r){s.timer(function(t){e(t)},t,r)},s.timer=function(t,e,r){if("function"!=typeof t)throw new Error("tick is required!");(e="number"==typeof e?e:s.speeds)<0&&(e=-e),s.timers.push({createTime:new Date,tick:t,duration:e,callback:r}),s.start()},s.start=function(){s.timerId||(s.timerId=setInterval(s.tick,s.interval))},s.tick=function(){var t,e,r,n,o,i,a,h=s.timers;for(s.timers=[],e=s.timers.length=0;e<h.length;e++)t=(o=h[e]).createTime,r=o.tick,i=o.duration,n=o.callback,!1,1<=(a=(+new Date-t)/i)&&!0,r(a=1<a?1:a),a<1?s.timers.push(o):n&&n();s.timers.length<=0&&s.stop()},s.stop=function(){s.timerId&&(clearInterval(s.timerId),s.timerId=null)},w.color=function(t){var e=w("head").css("color",t).css("color").replace(/^rgba?\(([^)]+)\)$/,"$1").split(new RegExp("\\,"+v.whitespace));return[+e[0],+e[1],+e[2],e[3]==c?1:+e[3]]},w.loop=function(t,e){var r,n=0;for(r in t)e(t[r],r,n++);return w};var f=function(t,e,r){t.beginPath(),t.fillStyle=e,r(t),t.fill()};function h(t){if(t&&t.constructor===CanvasRenderingContext2D)return t;var e=w(t);return 0<e.length?e[0].getContext("2d"):void 0}w.region=function(t,e,r){var o={},n=document.createElement("canvas"),i=[0,0,0],a="r";n.setAttribute("width",e),n.setAttribute("height",r);var h=w(t),s=n.getContext("2d"),u={drawer:function(t,e){return o[t]==c&&(o[t]={r:function(){return i[0]+=1,a="g","rgb("+i[0]+","+i[1]+","+i[2]+")"},g:function(){return i[1]+=1,a="b","rgb("+i[0]+","+i[1]+","+i[2]+")"},b:function(){return i[2]+=1,a="r","rgb("+i[0]+","+i[1]+","+i[2]+")"}}[a]()),f(s,o[t],e),u},erase:function(t){return f(s,"rgb(0,0,0)",t),u},getRegion:function(t){var e,r=h.position(t),n=s.getImageData(r.x-.5,r.y-.5,1,1).data;for(e in o)if("rgb("+n[0]+","+n[1]+","+n[2]+")"==o[e])return e;return c}};return u},w.prototype.canvas=function(){if(0<this.length&&"CANVAS"!=this[0].nodeName&&"canvas"!=this[0].nodeName)throw new Error("canvas is not function");return h(this)},w.prototype.layer=function(){if(0<this.length&&"CANVAS"!=this[0].nodeName&&"canvas"!=this[0].nodeName)throw new Error("layer is not function");var e=h(this),r=[],n={},o=this[0].clientWidth,i=this[0].clientHeight,a={get:function(t){return n[t]&&n[t].constructor===CanvasRenderingContext2D||(r.push(document.createElement("canvas")),r[r.length-1].setAttribute("width",o),r[r.length-1].setAttribute("height",i),n[t]=r[r.length-1].getContext("2d")),n[t]},clean:function(t){return t.clearRect(0,0,o,i),a},update:function(){if(e&&e.constructor===CanvasRenderingContext2D){var t;for(e.clearRect(0,0,o,i),e.save(),t=0;t<r.length;t++)e.drawImage(r[t],0,0,o,i,0,0,o,i);e.restore()}return a}};return a},w.prototype.webgl=function(t){if(0<this.length&&"CANVAS"!=this[0].nodeName&&"canvas"!=this[0].nodeName)throw new Error("Webgl is not a function!");return function(t,e){if(t&&t.constructor===WebGLRenderingContext)return t;var r,n=w(t),o=["webgl","experimental-webgl","webkit-3d","moz-webgl"],i=null;if(0<n.length)for(r=0;r<o.length;r++){try{i=n[0].getContext(o[r],e)}catch(t){}if(i)break}return i}(this,t)};var p=function(t,e){var r,n,o=[];for(r=0;r<4;r++)for(n=0;n<e.length/4;n++)o[4*n+r]=t[r]*e[4*n]+t[r+4]*e[4*n+1]+t[r+8]*e[4*n+2]+t[r+12]*e[4*n+3];return o};w.Matrix4=function(t){var l=t||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],g={move:function(t,e,r,n){return l=p(function(t,e,r,n){n=n||0;var o=Math.sqrt(e*e+r*r+n*n);return[1,0,0,0,0,1,0,0,0,0,1,0,e*t/o,r*t/o,n*t/o,1]}(t,e,r,n),l),g},rotate:function(t,e,r,n,o,i,a){var h,s,u,c=function(t,e,r,n,o,i){if("number"!=typeof t||"number"!=typeof e)throw new Error("a1 and b1 is required!");if("number"!=typeof r?(r=0,n=t,o=e,i=1):"number"==typeof n&&"number"==typeof o&&"number"==typeof i||(n=t,o=e,i=r,r=e=t=0),t==n&&e==o&&r==i)throw new Error("It's not a legitimate ray!");var a=Math.sqrt((n-t)*(n-t)+(o-e)*(o-e)),h=0!=a?(o-e)/a:1,s=0!=a?(n-t)/a:0,u=(n-t)*s+(o-e)*h,c=i-r,f=Math.sqrt(u*u+c*c),l=0!=f?c/f:1,g=0!=f?u/f:0;return[[h,l*s,s*g,0,-s,h*l,h*g,0,0,-g,l,0,e*s-t*h,r*g-t*s*l-e*h*l,-t*s*g-e*h*g-r*l,1],[h,-s,0,0,l*s,l*h,-g,0,s*g,h*g,l,0,t,e,r,1]]}(e,r,n,o,i,a);return l=p(p(p(c[1],(h=t,s=Math.sin(h),[u=Math.cos(h),s,0,0,-s,u,0,0,0,0,1,0,0,0,0,1])),c[0]),l),g},scale:function(t,e,r,n,o,i){var a,h,s,u,c,f;return l=p([a=t,0,0,0,0,h=e,0,0,0,0,s=r,0,(u=(u=n)||0)-u*a,(c=(c=o)||0)-c*h,(f=(f=i)||0)-f*s,1],l),g},multiply:function(t,e){return l=e?p(l,t):p(t,l),g},use:function(t,e,r,n){var o=p(l,[t,e,r=r||0,n=n||1]);return o[0]=Math.round(1e14*o[0])/1e14,o[1]=Math.round(1e14*o[1])/1e14,o[2]=Math.round(1e14*o[2])/1e14,o},value:function(){return l}};return g},w.hermite=function(){var s={u:.5},u=function(t){if(s.MR){var e=(t-s.a)/(s.b-s.a),r=e*e;return(e*r*s.MR[0]+r*s.MR[1]+e*s.MR[2]+s.MR[3])*(s.b-s.a)}throw new Error("You shoud first set the position!")};return u.setU=function(t){if("number"!=typeof t)throw new Error("Expecting a figure!");return s.u=.5*(1-t),u},u.setP=function(t,e,r,n,o,i){if(!(t<r))throw new Error("The point position should be increamented!");s.a=t,s.b=r;var a=s.u*o,h=s.u*i;return e/=r-t,n/=r-t,s.MR=[2*e-2*n+a+h,3*n-3*e-2*a-h,a,e],u},u},w.cardinal=function(){var e,o={t:0},i=function(t){if(o.hs){for(e=-1;e+1<o.hs.x.length&&(t>o.hs.x[e+1]||-1==e&&t>=o.hs.x[e+1]);)e+=1;if(-1==e||e>=o.hs.h.length)throw new Error("Coordinate crossing!");return o.hs.h[e](t)}throw new Error("You shoud first set the position!")};return i.setU=function(t){if("number"!=typeof t)throw new Error("Expecting a figure!");return o.t=t,i},i.setP=function(t){o.hs={x:[],h:[]};var e,r,n=(t[1][1]-t[0][1])/(t[1][0]-t[0][0]);for(o.hs.x[0]=t[0][0],e=1;e<t.length;e++){if(t[e][0]<=t[e-1][0])throw new Error("The point position should be increamented!");o.hs.x[e]=t[e][0],r=e<t.length-1?(t[e+1][1]-t[e-1][1])/(t[e+1][0]-t[e-1][0]):(t[e][1]-t[e-1][1])/(t[e][0]-t[e-1][0]),o.hs.h[e-1]=w.hermite().setU(o.t).setP(t[e-1][0],t[e-1][1],t[e][0],t[e][1],n,r),n=r}return i},i};var m=function(t,e,r,n){var o=Math.cos(t),i=Math.sin(t);return[e*o-r*i,e*i+r*o,n]};return w.map=function(){var p,d={c:[107,36],s:1},r=function(t,e){var r,n,o,i,a,h,s,u,c,f,l,g;return r=(360-e)/180*Math.PI,n=100*d.s,i=o=0,a=Math.cos(r),h=Math.sin(r),p=[i*h+n*a,o,i*a-n*h],p=m(t/180*Math.PI,p[0],p[1],p[2]),p=m((90-d.c[0])/180*Math.PI,p[0],p[1],p[2]),s=(90-d.c[1])/180*Math.PI,u=p[0],c=p[1],f=p[2],l=Math.cos(s),g=Math.sin(s),[-(p=[u,c*l-f*g,c*g+f*l])[0],p[1],p[2]]};return r.scale=function(t){return"number"==typeof t&&(d.s=t),r},r.center=function(t,e){return"number"==typeof t&&"number"==typeof e&&(d.c=[t,e]),r},r},w.useShaders=function(t,e,r){var n=w.webgl.loadShader(t,t.VERTEX_SHADER,e),o=w.webgl.loadShader(t,t.FRAGMENT_SHADER,r),i=t.createProgram();if(t.attachShader(i,n),t.attachShader(i,o),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS))throw new Error("Failed to link program: "+t.getProgramInfoLog(i));return t.useProgram(i),i},w.loadShader=function(t,e,r){var n=t.createShader(e);if(null==n)throw new Error("Unable to create shader!");if(t.shaderSource(n,r),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error("Failed to compile shader:"+t.getShaderInfoLog(n));return n},w.author="心叶",w.email="yelloxing@gmail.com",w.version="1.3.1",t.clay=t.$$=w,w});